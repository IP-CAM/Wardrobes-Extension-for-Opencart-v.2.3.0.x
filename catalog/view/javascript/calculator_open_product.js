$(document).ready(function () {    var check_sub_cat_id = 0; //if sub category not select    var check_root_cat_id = 0; //if root category not select    var check_product_id = 0; //if sub category not select    //Выбор главной категории    $("[data-cal_root]:visible:not(input)").click(function () {        ajaxRenderRoot($(this));    });    //Выбор главной категории    $("input[data-cal_root]:visible").change(function () {        ajaxRenderRoot($(this));    });    function ajaxRenderRoot(this_root_item) {        var id = this_root_item.parent().find('input').val();        //alert('check_root_cat_id' + check_root_cat_id + 'id' +id);        $(".box_root_item:visible").find('p').addClass('no-active');        hideSubCategories(); // Hide sub categories and products        if(check_sub_cat_id != id && check_root_cat_id != id) {            $('.box_root:visible').find('input').prop('checked', false);            this_root_item.find("input").prop('checked', true);            this_root_item.find('p').removeClass('no-active');            ajaxOpenCategory(id, 'root'); //Show sub categories        } else { //Если этот элемент уже был выбран, то закрываем все, и делаем как было            $('.box_root:visible').find('input').prop('checked', false);            check_sub_cat_id = 0;            check_root_cat_id = 0;        }    }    $(document).on('click', '.dynamic_category', function () {        $('.dynamic_category').find('img').addClass('no-active');        $('.dynamic_category').find('p').addClass('no-active');        var this_sub_category = $(this);        var id = this_sub_category.find('input:checkbox').val();        if(check_root_cat_id != id) {            ajaxOpenCategory(id, 'products');            $('.dynamic_category').find('input').prop('checked', false);            this_sub_category.find("input").prop('checked', true);            this_sub_category.find('img').removeClass('no-active');            this_sub_category.find('p').removeClass('no-active');        } else {            var product_box = $("[name='product_box']");            product_box.empty();        }    });    function hideSubCategories() {        var type_sub_box = $("[name='sub_box']");        type_sub_box.empty();        var type_product_box = $("[name='product_box']");        type_product_box.empty();        $("[name='type-wardrobes']").hide();        $("[name='type-products']").hide();    }    function ajaxRenderCategories_desktop(data, root) {        hideSubCategories();        $("[name='type-wardrobes']").show();        var type_sub_box = $("[name='sub_box']:visible");        var html = '';        $.each(data, function (index, value) {            html += '<div class="col-sm-3 dynamic_category">';            html += '<div class="box sub_box_item">';            html += '<input type="checkbox" name="category_sub" value="' + value['category_id'] + '" >';            html += '<img src="' + value['image'] + '"';            html += 'title="' + value["name"] + '"';            html += 'alt="' + value["name"] + '"';            html += 'class="img-responsive center-block no-active"/>';            html += '<p>' + value["name"] + '</p>';            html += '</div>';            html += '</div>';        });        type_sub_box.append(html);    }    function ajaxRenderCategories_mobile(data, root) {        hideSubCategories();        $("[name='type-wardrobes']").show();        var type_sub_box = $("[name='sub_box']:visible");        var html = '';        $.each(data, function (index, value) {            html += '<div class="dynamic_category">';            html += '<div class="box sub_box_item">';            html += '<input type="checkbox" name="category_sub" value="' + value['category_id'] + '" >';            html += '<img src="' + value['image'] + '"';            html += 'title="' + value["name"] + '"';            html += 'alt="' + value["name"] + '"';            html += 'class="img-responsive center-block no-active"/>';            html += '<p>' + value["name"] + '</p>';            html += '</div>';            html += '</div>';        });        type_sub_box.append(html);    }    function ajaxRenderProducts_desktop(data, root) {        // alert('products' + root);        if(root == 1) {            // alert('hide');            hideSubCategories();        }        $("[name='type-products']").show();        var type_product_box = $("[name='product_box']");        type_product_box.empty();        var html = '<div id="carousel" class="carousel-control">';        $.each(data, function (index, value) {            html += '<div class="product_item box">';            html += '<input type="checkbox" name="products" value="' + value['product_id'] + '" >';            html += '<img src="' + value['image'] + '"';            html += 'title="' + value["name"] + '"';            html += 'alt="' + value["name"] + '"';            html += 'class="img-responsive center-block"/>';            html += '<p>' + value["name"] + "<br> Модель:" + value["model"] + '</p>';            html += '</div>';        });        html += '</div>';        type_product_box.append(html);        $("#carousel").owlCarousel({            navigation: true,            pagination:  false,            navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>']        });    }    function ajaxRenderProducts_mobile(data, root) {        // alert('products' + root);        if(root == 1) {            hideSubCategories();        }        $("[name='type-products']").show();        var type_product_box = $("[name='product_box']");        type_product_box.empty();        var html = '';        //html +=  = '<div class=" owl-carousel owl-theme" id="carousel">';        for(var i = 0; i < data.length;) {            //html += '<div class="product-box-carusel-mobile owl-item">';            //for(var ii = 0; ii < 4; ii++) {                html += '<div class="product_item box sub_box_item ">';                html += '<input type="checkbox" name="products" value="' + data[i]['product_id'] + '" >';                html += '<img src="' + data[i]['image'] + '"';                html += 'title="' + data[i]["name"] + '"';                html += 'alt="' + data[i]["name"] + '"';                html += 'class="img-responsive center-block"/>';                html += '<p>Модель: ' + data[i]["model"] + '</p>';                html += '</div>';           // }            //	html += '</div>';           // i += 4;            i++;        }        html += '</div>';        type_product_box.append(html);        /*$("#carousel").owlCarousel({         navigation: true,         pagination:  false,         navigationText: ['<i class="fa fa-chevron-left fa-5x"></i>', '<i class="fa fa-chevron-right fa-5x"></i>']         });*/    }    function ajaxOpenCategory(id, type) {        $.ajax({            url: 'index.php?route=calculator/calculator/ajaxOpen',            dataType: 'json',            data: 'id=' + id + '&type=' + type,            type: 'post',            beforeSend: function () {            },            success: function (json) {                var type = json['type'];                if (type.localeCompare("categories") == 0) {                    if(!mobileDetect()) {                        ajaxRenderCategories_desktop(json['data'], json['root']); //Для компьютерной версии                    } else  {                        ajaxRenderCategories_mobile(json['data'], json['root']); //Для мобильной версии                    }                    check_root_cat_id = id;                }                if (type.localeCompare("products") == 0) {                    if(!mobileDetect()) {                        ajaxRenderProducts_desktop(json['data'], json['root']); //Для компьютерной версии                    } else {                        ajaxRenderProducts_mobile(json['data'], json['root']); //Для мобильной версии                    }                }                if (type.localeCompare("no_edit") == 0) {                }                check_sub_cat_id = id;                //alert('check_sub_cat_id ' + check_sub_cat_id + ' check_root_cat_id ' + check_root_cat_id);            },            error: function (xhr, ajaxOptions, thrownError) {                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);            }        });    }    $(document).on('click', '.product_item', function () {        $('.product_item').find('img').addClass('no-active');        $('.product_item').find('p').addClass('no-active');        var this_product = $(this);        var id = this_product.find('input:checkbox').val();        if(check_product_id != id) {            $('.product_item').find('input').prop('checked', false);            this_product.find("input").prop('checked', true);            this_product.find('img').removeClass('no-active');            this_product.find('p').removeClass('no-active');            $('input[name="product_id"]').val(id);        } else {            var product_box = $("[name='product_box']");            product_box.empty();        }    });});